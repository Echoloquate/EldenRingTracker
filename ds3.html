<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dark Souls III - Item Tracker</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap');

  :root {
    --ember: #c4703c;
    --ember-dim: #8a5028;
    --ember-bright: #e8944c;
    --bg: #0a0a0c;
    --bg-card: #13110f;
    --bg-card-hover: #1c1914;
    --border: #251f18;
    --border-light: #382e22;
    --text: #b0a48a;
    --text-dim: #686050;
    --text-bright: #d8ccb0;
    --checked-text: #3a3830;
    --green: #5a8a4a;
    --green-dim: #3a5a2a;
    --red: #8a3a3a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Lora', Georgia, serif;
    font-size: 17px;
    line-height: 1.6;
    min-height: 100vh;
  }

  /* Subtle ash texture overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-conic-gradient(rgba(196,112,60,0.006) 0% 25%, transparent 0% 50%) 0 0 / 4px 4px;
    pointer-events: none;
    z-index: 999;
  }

  header {
    text-align: center;
    padding: 3rem 1rem 1rem;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, rgba(196,112,60,0.06) 0%, transparent 100%);
  }

  header h1 {
    font-family: 'Cinzel', serif;
    font-weight: 700;
    font-size: clamp(1.6rem, 4vw, 2.4rem);
    color: var(--ember);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    text-shadow: 0 0 40px rgba(196,112,60,0.15);
  }

  header h1 span {
    display: block;
    font-size: 0.45em;
    color: var(--text-dim);
    letter-spacing: 0.3em;
    margin-top: 0.3rem;
    font-weight: 400;
  }

  /* Progress bar area */
  .progress-area {
    max-width: 900px;
    margin: 0 auto;
    padding: 1.2rem 1.5rem;
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
  }

  .progress-stats {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 0.5rem;
    font-family: 'Cinzel', serif;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .progress-stats .count { color: var(--ember); }
  .progress-stats .percent { color: var(--text-dim); }

  .progress-bar {
    width: 100%;
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--ember-dim), var(--ember));
    border-radius: 2px;
    transition: width 0.4s ease;
    box-shadow: 0 0 8px rgba(196,112,60,0.3);
  }

  /* Controls */
  .controls {
    max-width: 900px;
    margin: 0 auto;
    padding: 0.8rem 1.5rem;
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    align-items: center;
    border-bottom: 1px solid var(--border);
  }

  .controls input[type="search"] {
    flex: 1;
    min-width: 200px;
    padding: 0.5rem 0.8rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text-bright);
    font-family: 'Crimson Text', serif;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s;
  }

  .controls input[type="search"]:focus {
    border-color: var(--ember-dim);
  }

  .controls input[type="search"]::placeholder {
    color: var(--text-dim);
  }

  .filter-btn {
    padding: 0.4rem 0.8rem;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text-dim);
    font-family: 'Cinzel', serif;
    font-size: 0.65rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }

  .filter-btn:hover { border-color: var(--ember-dim); color: var(--text); }
  .filter-btn.active { border-color: var(--ember); color: var(--ember); background: rgba(196,112,60,0.08); }

  /* Main content */
  main {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 1.5rem 4rem;
  }

  /* DLC divider */
  .dlc-divider {
    text-align: center;
    padding: 2.5rem 0 0.5rem;
  }

  .dlc-divider h2 {
    font-family: 'Cinzel', serif;
    font-weight: 600;
    font-size: 1rem;
    color: var(--ember-dim);
    letter-spacing: 0.25em;
    text-transform: uppercase;
    position: relative;
    display: inline-block;
  }

  .dlc-divider h2::before,
  .dlc-divider h2::after {
    content: '';
    position: absolute;
    top: 50%;
    width: 60px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--ember-dim));
  }

  .dlc-divider h2::before { right: calc(100% + 16px); }
  .dlc-divider h2::after { left: calc(100% + 16px); transform: scaleX(-1); }

  /* Location sections */
  .location {
    margin-top: 1.5rem;
  }

  .location-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.6rem 0;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    user-select: none;
    transition: border-color 0.2s;
  }

  .location-header:hover { border-bottom-color: var(--ember-dim); }

  .location-header h3 {
    font-family: 'Cinzel', serif;
    font-weight: 600;
    font-size: 1.05rem;
    color: var(--text-bright);
    letter-spacing: 0.06em;
  }

  .location-count {
    font-family: 'Cinzel', serif;
    font-size: 0.7rem;
    color: var(--text-dim);
    letter-spacing: 0.05em;
  }

  .location-count .done { color: var(--green); }

  .location.all-done .location-header h3 { color: var(--ember-dim); }
  .location.all-done .location-count .done { color: var(--ember-dim); }

  /* Item list */
  .items { padding: 0.3rem 0; }

  .item {
    display: flex;
    align-items: flex-start;
    gap: 0.7rem;
    padding: 0.5rem 0.6rem;
    border-radius: 4px;
    transition: background 0.15s;
    cursor: pointer;
  }

  .item:hover { background: var(--bg-card-hover); }

  .item input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    min-width: 18px;
    border: 1.5px solid var(--border-light);
    border-radius: 3px;
    margin-top: 3px;
    cursor: pointer;
    position: relative;
    transition: all 0.2s;
    background: transparent;
  }

  .item input[type="checkbox"]:hover {
    border-color: var(--ember-dim);
  }

  .item input[type="checkbox"]:checked {
    background: var(--ember-dim);
    border-color: var(--ember-dim);
  }

  .item input[type="checkbox"]:checked::after {
    content: '\2713';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    color: var(--bg);
    font-weight: bold;
  }

  .item-text {
    flex: 1;
    transition: color 0.2s;
  }

  .item.checked .item-text {
    color: var(--checked-text);
    text-decoration: line-through;
    text-decoration-color: var(--border);
  }

  .item-replaces {
    display: inline;
    font-weight: 600;
    color: var(--ember);
    transition: color 0.2s;
  }

  .item.checked .item-replaces {
    color: var(--checked-text);
  }

  /* Collapse animation */
  .items[data-collapsed="true"] {
    display: none;
  }

  /* Hidden by filter */
  .item[data-hidden="true"] { display: none; }
  .location[data-hidden="true"] { display: none; }

  /* Reset button */
  .reset-area {
    text-align: center;
    padding: 3rem 0;
    border-top: 1px solid var(--border);
    margin-top: 3rem;
  }

  .reset-btn {
    padding: 0.5rem 1.5rem;
    background: transparent;
    border: 1px solid var(--red);
    border-radius: 4px;
    color: var(--red);
    font-family: 'Cinzel', serif;
    font-size: 0.7rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }

  .reset-btn:hover {
    background: rgba(138,58,58,0.15);
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--ember-dim); }

  /* Room picker modal */
  .room-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .room-overlay[hidden] { display: none; }

  .room-modal {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: 8px;
    padding: 2.5rem 2rem;
    max-width: 380px;
    width: 90%;
    text-align: center;
  }

  .room-modal h2 {
    font-family: 'Cinzel', serif;
    font-size: 1.1rem;
    color: var(--ember);
    letter-spacing: 0.12em;
    text-transform: uppercase;
    margin-bottom: 0.4rem;
  }

  .room-modal p {
    color: var(--text-dim);
    font-size: 0.95rem;
    margin-bottom: 1.5rem;
  }

  .room-modal input[type="text"] {
    width: 100%;
    padding: 0.6rem 0.8rem;
    background: var(--bg);
    border: 1px solid var(--border-light);
    border-radius: 4px;
    color: var(--ember-bright);
    font-family: 'Cinzel', serif;
    font-size: 1.1rem;
    letter-spacing: 0.25em;
    text-align: center;
    text-transform: uppercase;
    outline: none;
    transition: border-color 0.2s;
  }

  .room-modal input[type="text"]:focus {
    border-color: var(--ember-dim);
  }

  .room-modal input[type="text"]::placeholder {
    color: var(--text-dim);
    font-size: 0.8rem;
    letter-spacing: 0.1em;
    text-transform: none;
  }

  .room-modal .room-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  .room-modal .room-btn {
    flex: 1;
    padding: 0.55rem 0.8rem;
    border: 1px solid var(--border-light);
    border-radius: 4px;
    background: transparent;
    color: var(--text);
    font-family: 'Cinzel', serif;
    font-size: 0.7rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }

  .room-modal .room-btn:hover {
    border-color: var(--ember-dim);
    color: var(--ember);
  }

  .room-modal .room-btn.primary {
    border-color: var(--ember-dim);
    color: var(--ember);
    background: rgba(196,112,60,0.08);
  }

  .room-modal .room-btn.primary:hover {
    background: rgba(196,112,60,0.15);
  }

  .room-modal .room-error {
    color: var(--red);
    font-size: 0.85rem;
    margin-top: 0.7rem;
    min-height: 1.2em;
  }

  /* Room badge in controls bar */
  .room-badge {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.3rem 0.6rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: 'Cinzel', serif;
    font-size: 0.65rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--ember-dim);
  }

  .room-badge code {
    color: var(--ember);
    font-family: 'Cinzel', serif;
    font-size: 0.7rem;
    letter-spacing: 0.2em;
  }

  .room-badge .leave-btn {
    background: none;
    border: none;
    color: var(--text-dim);
    font-family: 'Cinzel', serif;
    font-size: 0.6rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    cursor: pointer;
    padding: 0.1rem 0.3rem;
    margin-left: 0.2rem;
    transition: color 0.2s;
  }

  .room-badge .leave-btn:hover {
    color: var(--red);
  }

  .sync-error {
    max-width: 900px;
    margin: 0 auto;
    padding: 0.6rem 1.5rem;
    background: rgba(138,58,58,0.15);
    border-bottom: 1px solid var(--red);
    color: var(--red);
    font-size: 0.9rem;
    text-align: center;
  }

  .sync-error[hidden] { display: none; }

  .nav-link {
    display: inline-block;
    margin-top: 0.8rem;
    padding: 0.4rem 1rem;
    font-family: 'Cinzel', serif;
    font-size: 0.65rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ember-dim);
    text-decoration: none;
    border: 1px solid var(--border-light);
    border-radius: 4px;
    transition: all 0.2s;
  }

  .nav-link:hover { color: var(--ember); border-color: var(--ember-dim); background: rgba(196,112,60,0.08); }

  /* Info box */
  .info-box {
    max-width: 900px;
    margin: 0 auto;
    border-bottom: 1px solid var(--border);
  }

  .info-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    width: 100%;
    padding: 0.5rem 1.5rem;
    background: transparent;
    border: none;
    color: var(--text-dim);
    font-family: 'Cinzel', serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: color 0.2s;
  }

  .info-toggle:hover { color: var(--ember-dim); }

  .info-toggle .arrow {
    display: inline-block;
    transition: transform 0.2s;
    font-size: 0.5rem;
  }

  .info-toggle.open .arrow { transform: rotate(180deg); }

  .info-content {
    display: none;
    padding: 0 1.5rem 1rem;
    color: var(--text-dim);
    font-size: 0.92rem;
    line-height: 1.7;
  }

  .info-content.open { display: block; }

  .info-content p { margin-bottom: 0.6rem; }

  .info-content a {
    color: var(--ember-dim);
    text-decoration: none;
    transition: color 0.2s;
  }

  .info-content a:hover { color: var(--ember); }

  /* Loading spinner */
  .loading {
    display: flex;
    justify-content: center;
    padding: 4rem 0;
  }

  .loading .spinner {
    width: 28px;
    height: 28px;
    border: 2.5px solid var(--border-light);
    border-top-color: var(--ember-dim);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  @media (max-width: 600px) {
    .controls { padding: 0.6rem 1rem; }
    main { padding: 0 1rem 3rem; }
    .progress-area { padding: 0.8rem 1rem; }
  }
</style>
<!-- Firebase SDK (compat builds for simplicity - no bundler needed) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
</head>
<body>

<header>
  <h1>Dark Souls III<span>Item Tracker</span></h1>
  <a href="./" class="nav-link">&larr; All Trackers</a>
  <a href="er.html" class="nav-link">Elden Ring &rarr;</a>
</header>

<div class="info-box">
  <button class="info-toggle" id="infoToggle">
    About this tracker <span class="arrow">&#9660;</span>
  </button>
  <div class="info-content" id="infoContent">
    <p>This is a checklist for the <a href="https://www.nexusmods.com/darksouls3/mods/361" target="_blank" rel="noopener">Dark Souls III Item Randomizer</a> by thefifthmatt. It covers all key items, boss souls, estus shards, undead bone shards, ashes, crystal lizards, ring locations, and shop checks across the base game, Ashes of Ariandel, and The Ringed City.</p>
    <p>Create a room to share progress with your co-op group in real time - just give everyone the same room code and checks will sync automatically.</p>
  </div>
</div>

<div class="progress-area">
  <div class="progress-stats">
    <span class="count" id="progressCount">0 / 0</span>
    <span class="percent" id="progressPercent">0%</span>
  </div>
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
  </div>
</div>

<div class="controls">
  <input type="search" id="searchBox" placeholder="Search items or locations...">
  <button class="filter-btn active" data-filter="all">All</button>
  <button class="filter-btn" data-filter="unchecked">Remaining</button>
  <button class="filter-btn" data-filter="checked">Completed</button>
  <span class="room-badge" id="roomBadge" hidden>
    Room <code id="roomCodeDisplay"></code>
    <button class="leave-btn" id="leaveRoomBtn">Leave</button>
  </span>
</div>
<div class="sync-error" id="syncError" hidden></div>

<div class="room-overlay" id="roomOverlay">
  <div class="room-modal">
    <h2>Multiplayer Tracker</h2>
    <p>Create or join a room to sync progress with your group.</p>
    <input type="text" id="roomCodeInput" placeholder="Enter room code" maxlength="6" spellcheck="false" autocomplete="off">
    <div class="room-actions">
      <button class="room-btn primary" id="createRoomBtn">Create Room</button>
      <button class="room-btn" id="joinRoomBtn">Join Room</button>
    </div>
    <div class="room-error" id="roomError"></div>
  </div>
</div>

<main id="main"><div class="loading"><div class="spinner"></div></div></main>

<script>
// =============================================================================
// FIREBASE CONFIGURATION (shared with Elden Ring tracker)
// =============================================================================
const firebaseConfig = {
  apiKey: "AIzaSyAEWn2CFxUsowJDYrfog0HZeYCpzz2RKQA",
  authDomain: "elden-ring-tracker-de9af.firebaseapp.com",
  databaseURL: "https://elden-ring-tracker-de9af-default-rtdb.firebaseio.com",
  projectId: "elden-ring-tracker-de9af",
  storageBucket: "elden-ring-tracker-de9af.firebasestorage.app",
  messagingSenderId: "1049629299505",
  appId: "1:1049629299505:web:ef3ee3865bc3d2375e5610"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// =============================================================================
// DATA - parsed from raw item check text
// =============================================================================
const RAW_DATA = `--- Cemetery of Ash
Major boss in Cemetery of Ash: Dropped by Iudex Gundyr. Replaces Coiled Sword.
Powerful enemy in Cemetery of Ash: Dropped by Ravenous Crystal Lizard. Replaces Titanite Scale.

--- Firelink Shrine
Key item in Firelink Shrine: Sold by both Shrine Handmaid and Untended Graves Handmaid
Shop in Firelink Shrine: Sold by Cornyx after recruiting him, or in his ashes
Shop in Firelink Shrine: Sold by Greirat after recruiting him, or in his ashes
Shop in Firelink Shrine: Sold by Handmaid
Shop in Firelink Shrine: Sold by Handmaid after defeating Abyss Watchers
Shop in Firelink Shrine: Sold by Handmaid after defeating Alrich, Devourer of Gods
Shop in Firelink Shrine: Sold by Handmaid after defeating Champion Gundyr
Shop in Firelink Shrine: Sold by Handmaid after defeating Crystal Sage
Shop in Firelink Shrine: Sold by Handmaid after defeating Dancer of the Boreal Valley
Shop in Firelink Shrine: Sold by Handmaid after defeating High Lord Wolnir
Shop in Firelink Shrine: Sold by Handmaid after defeating Lothric, Younger Prince
Shop in Firelink Shrine: Sold by Handmaid after defeating Nameless King
Shop in Firelink Shrine: Sold by Handmaid after defeating Sister Friede
Shop in Firelink Shrine: Sold by Handmaid after defeating Soul of Cinder
Shop in Firelink Shrine: Sold by Handmaid after giving Captain's Ashes
Shop in Firelink Shrine: Sold by Handmaid after giving Dragon Chaser's Ashes
Shop in Firelink Shrine: Sold by Handmaid after giving Dreamchaser's Ashes
Shop in Firelink Shrine: Sold by Handmaid after giving Easterner's Ashes
Shop in Firelink Shrine: Sold by Handmaid after giving Grave Warden's Ashes
Shop in Firelink Shrine: Sold by Handmaid after giving Mortician's Ashes
Shop in Firelink Shrine: Sold by Handmaid after giving Paladin's Ashes
Shop in Firelink Shrine: Sold by Handmaid after giving Prisoner Chief's Ashes
Shop in Firelink Shrine: Sold by Handmaid after giving Xanthous Ashes
Shop in Firelink Shrine: Sold by Handmaid after placing all Cinders of a Lord on their thrones
Shop in Firelink Shrine: Sold by Irina after recruiting her, or in her ashes
Shop in Firelink Shrine: Sold by Karla after recruiting her, or in her ashes
Powerful enemy in Firelink Shrine: Dropped by Sword Master. Replaces Uchigatana.

--- Firelink Shrine Roof
Flask upgrade in Firelink Shrine Roof: In the Firelink Shrine rafters, accessible from the roof. Replaces Estus Shard.
Chest + Ring in Firelink Shrine Roof: From the Firelink Shrine roof, past the rafters and an illusory wall. Replaces Covetous Silver Serpent Ring.
Small crystal lizard in Firelink Shrine Roof: Dropped by the Crystal Lizard behind Firelink Shrine. Can be accessed with tree jump by going all the way around the roof, left of the entrance to the rafters, or alternatively dropping down from the Bell Tower. Replaces Twinkling Titanite.

--- Firelink Bell Tower
Key item in Firelink Bell Tower: At the top of the Bell Tower. Replaces Fire Keeper Soul.
Ring in Firelink Bell Tower: Dropping down from the Bell Tower to where Irina eventually resides. Replaces Estus Ring.

--- High Wall
Key item in High Wall: Dropped by Emma upon killing her. This is possible to do at any time. Replaces Basin of Vows.
Key item in High Wall: Given by Emma, or dropped upon death. Replaces Small Lothric Banner.
Key item in High Wall: In the basement of the building with Pus of Man on the roof, down the stairs guarded by a dog. Replaces Cell Key.
Major boss in High Wall: Dropped by Vordt of the Boreal Valley. Replaces Soul of Boreal Valley Vordt.
Flask upgrade in High Wall: In the basement of the building with the Pus of Man on the roof, on the blacksmith anvil. Replaces Estus Shard.
Chest in High Wall: In the building with the Pus of Man on the roof, past the Lothric Knight down a hallway obscured by a wooden wheel, dropping down past the edge. Replaces Astora Straight Sword.
Chest in High Wall: In the chest on the balcony overlooking the basement of the building with the Pus of Man on the roof. Replaces Silver Eagle Kite Shield.
Powerful enemy in High Wall: Dropped by mimic in the building guarded by the fire-breathing wyvern. Replaces Deep Battle Axe.
Small crystal lizard in High Wall: Dropped by the Crystal Lizard on the rooftop after the Tower on the Wall bonfire. Replaces Raw Gem.
Ring in High Wall: Coming from the elevator shortcut, on a side path to the left (toward Winged Knight area), jumping onto a wooden support. Replaces Ring of Sacrifice.

--- High Wall Lift Cell
Powerful enemy in High Wall Lift Cell: Dropped by the Darkwraith past the Lift Chamber Key. Replaces Red Eye Orb.

--- Undead Settlement
Major boss in Undead Settlement: Dropped by Curse Rotted Greatwood. Replaces Soul of the Rotted Greatwood, Transposing Kiln.
Flask upgrade in Undead Settlement: In front of the burning tree guarded by the Cathedral Evangelist. Replaces Estus Shard.
Flask upgrade in Undead Settlement: In the area past the Dilapidated Bridge bonfire, where the Giant is shooting arrows, jumping to the floating platform on the right. Replaces Undead Bone Shard.
Chest in Undead Settlement: In a chest after Fire Demon. Cage Spiders activate open opening it. Replaces Human Pine Resin 4x.
Ashes in Undead Settlement: In the area past the Dilapidated Bridge bonfire, where the Giant is shooting arrows, at the close end of the graveyard. Replaces Mortician's Ashes.
Powerful enemy in Undead Settlement: Dropped by the Boreal Outright Knight before Road of Sacrifices. Replaces Irithyll Straight Sword.
Powerful enemy in Undead Settlement: Dropped by the Fire Demon you fight with Siegward. Replaces Fire Gem.
Small crystal lizard in Undead Settlement: Drop by Crystal Lizard in ravine accessible by Grave Key or dropping down near Eygon. Replaces Heavy Gem.
Small crystal lizard in Undead Settlement: Drop by Crystal Lizard near Dilapidated Bridge bonfire. Replaces Sharp Gem.
Ring in Undead Settlement: At the end of the Fire Demon loop, in the tower where you have to drop down after the roof. Replaces Chloranthy Ring.
Ring in Undead Settlement: Dropped by the large rat in the sewers with grave access. Replaces Bloodbite Ring.
Ring in Undead Settlement: From the area bombarded by firebombs above the Cliff Underside bonfire. Replaces Fire Clutch Ring.
Ring in Undead Settlement: On a hanging corpse in the area with the Pit of Hollows cage manservant, after the thrall area, overlooking the entrance to the Giant's tower. Replaces Flame Stoneplate Ring.
Ring in Undead Settlement: On the roof toward the end of the Fire Demon loop, past the Cathedral Evangelists. Replaces Flynn's Ring.

--- Road of Sacrifices
Key item in Road of Sacrifices: At the end of the Farron Keep Perimeter building on Crucifixion Woods side, behind the Black Knight. Replaces Farron Coal.
Major boss in Road of Sacrifices: Dropped by Crystal Sage. Replaces Soul of a Crystal Sage.
Flask upgrade in Road of Sacrifices: Behind the building leading to Crystal Sage, approached from Crucifixion Woods bonfire. Can drop down on left side of go under bridge on right side. Replaces Estus Shard.
Powerful enemy in Road of Sacrifices: Dropped by the club-wielding Exile Knight before the ladder down to Farron Keep. Replaces Great Club.
Powerful enemy in Road of Sacrifices: Dropped by the greatsword-wielding Exile Knight before the ladder down to Farron Keep. Replaces Exile Greatsword.
Small crystal lizard in Road of Sacrifices: Dropped by the Crystal Lizard in the building before Crystal Sage. Replaces Crystal Gem.
Ring in Road of Sacrifices: Drop down from the platform behind the sorcerer in the building before Crystal Sage, entering from the stairs leading up from the crab area. Replaces Ring of Sacrifice.
Ring in Road of Sacrifices: Dropped by Greater Crab in Crucifixion Woods close to the Farron Keep outer wall. Replaces Great Swamp Ring.
Ring in Road of Sacrifices: Dropping down before the bridge leading up to Halfway Fortress from Road of Sacrifices, guarded by the maggot belly dog. Replaces Morne's Ring.
Ring in Road of Sacrifices: In an alcove under the building before Crystal Sage, guarded by a Lycanthrope, accessible from the swamp or from dropping down. Replaces Sage Ring.

--- Farron Keep
Key item in Farron Keep: In the pavillion guarded by a Darkwraith, straight ahead from the Farron Keep bonfire to the left of the ritual fire stairs. Replaces Sage's Coal.
Major boss in Farron Keep: Dropped by Abyss Watchers. Replaces Soul of the Blood of the Wolf, Cinders of a Lord (Abyss Watchers).
Flask upgrade in Farron Keep: In a standalone pavillion down the ramp from Keep Ruins bonfire and to the right. Replaces Undead Bone Shard.
Flask upgrade in Farron Keep: Straight ahead from the Farron Keep bonfire to the ritual fire stairs, guarded by a slug. Replaces Estus Shard.
Chest in Farron Keep: In a chest in the cave found along the keep wall in the basilisk area, with the Elizabeth corpse. Replaces Antiquated Dress.
Ashes in Farron Keep: Near the Old Wolf of Farron bonfire, behind an illusory wall near the Crystal Lizard. Replaces Dreamchaser's Ashes.
Powerful enemy in Farron Keep: Dropped by Ravenous Crystal Lizard near the shortcut from Farron Keep back to Road of Sacrifices. Replaces Titanite Scale 2x.
Powerful enemy in Farron Keep: Dropped by Stray Demon on the bridge above Farron Keep. Replaces Soul of a Stray Demon.
Small crystal lizard in Farron Keep: Dropped by the closer Crystal Lizard in the area dropping down from near Stray Demon, up from Old Wolf of Farron bonfire. Replaces Large Titanite Shard.
Small crystal lizard in Farron Keep: Dropped by the Crystal Lizard on the balcony behind the Old Wolf of Farron bonfire. Replaces Twinkling Titanite.
Small crystal lizard in Farron Keep: Dropped by the Crystal Lizard that scurries up the stairs in the area dropping down from near Stray Demon, up from Old Wolf of Farron bonfire. Replaces Heavy Gem.
Small crystal lizard in Farron Keep: Dropped by the farther Crystal Lizard in the area dropping down from near Stray Demon, up from Old Wolf of Farron bonfire. Replaces Large Titanite Shard.
Ring in Farron Keep: Dropped by the Greater Crab patrolling the birch tree where the Giant shoots arrows. Replaces Lingering Dragoncrest Ring.

--- Cathedral of the Deep
Major boss in Cathedral of the Deep: Dropped by Deacons of the Deep. Replaces Soul of the Deacons of the Deep, Small Doll.
Flask upgrade in Cathedral of the Deep: In the graveyard with the Infested Corpses, on a coffin partly hanging off of the ledge. Replaces Undead Bone Shard.
Flask upgrade in Cathedral of the Deep: Right outside of the Cleansing Chapel. Requires killing praying hollows. Replaces Estus Shard.
Ashes in Cathedral of the Deep: At the very start of the area, guarded by the Fallen Knight. Replaces Paladin's Ashes.
Powerful enemy in Cathedral of the Deep: Dropped by the brigand at the start of Cathedral of the Deep. Replaces Spider Shield.
Powerful enemy in Cathedral of the Deep: Dropped by the Mimic before the room with the patrolling Cathedral Knight and Deep Accursed. Replaces Deep Braille Divine Tome.
Powerful enemy in Cathedral of the Deep: Dropped by the Ravenous Crystal Lizard outside of the Cathedral. Replaces Titanite Scale.
Small crystal lizard in Cathedral of the Deep: Dropped by the Crystal Lizard behind the cathedral near the Infested Corpse moat, going from the Ravenous Crystal Lizard. Replaces Twinkling Titanite.
Small crystal lizard in Cathedral of the Deep: Dropped by the Crystal Lizard under the cathedral near the Infested Corpse moat, going from the Ravenous Crystal Lizard. Replaces Twinkling Titanite.
Small crystal lizard in Cathedral of the Deep: Dropped by the first Crystal Lizard after the Crystal Sage fight. Replaces Twinkling Titanite.
Small crystal lizard in Cathedral of the Deep: Dropped by the second Crystal Lizard after the Crystal Sage fight. Replaces Twinkling Titanite.
Ring in Cathedral of the Deep: In the pit with the Infested Corpse, accessible from the Ravenous Crystal Lizard area or from dropping down near the second Cleansing Chapel shortcut. Replaces Poisonbite Ring.
Ring in Cathedral of the Deep: On the ledge where the Giant Slave slams his arms down. Replaces Lloyd's Sword Ring.

--- Catacombs of Carthus
Major boss in Catacombs of Carthus: Dropped by High Lord Wolnir. Replaces Soul of High Lord Wolnir.
Flask upgrade in Catacombs of Carthus: Dropped by first Skeleton Ball after killing its sorcerer skeleton. Replaces Undead Bone Shard.
Ashes in Catacombs of Carthus: From the Catacombs bonfire, down the stairs into the main hall and up the stairs to the other side, on the far left side. Stairwell past the illusory wall is most direct. Replaces Grave Warden's Ashes.
Powerful enemy in Catacombs of Carthus: Dropped by killing Sulyvahn's Beast on the bridge to Irithyll or in the lake below. Replaces Pontiff's Right Eye.
Powerful enemy in Catacombs of Carthus: Dropped by the Fire Demon before Smouldering Lake. Replaces Soul of a Demon.
Powerful enemy in Catacombs of Carthus: Dropped by the mimic before Smouldering Lake. Replaces Black Blade.
Small crystal lizard in Catacombs of Carthus: Dropped by a Crystal Lizard found between the Catacombs main halls and the ledge overlooking the bridge you can cut down. Replaces Fire Gem.
Small crystal lizard in Catacombs of Carthus: Dropped by a Crystal Lizard found to the left before going down the main stairwell in the Catacombs, past the skeleton ambush and past where Anri is standing. Replaces Twinkling Titanite.
Ring in Catacombs of Carthus: After the first Skeleton Ball, in the hallway alcove with the many dark-exploding pots. Replaces Carthus Milkring.
Ring in Catacombs of Carthus: At the very end of the Bonewheel Skeleton area. Replaces Carthus Bloodring.
Ring in Catacombs of Carthus: Down the ramp from the Fire Demon, straight down the hallway past the room with the Abandoned Tomb bonfire. Replaces Old Sage's Blindfold.

--- Smouldering Lake
Major boss in Smouldering Lake: Dropped by Old Demon King in Smouldering Lake. Replaces Soul of the Old Demon King.
Flask upgrade + Powerful enemy in Smouldering Lake: Dropped by the giant Carthus Sandworm. Replaces Lightning Stake, Undead Bone Shard.
Flask upgrade in Smouldering Lake: Behind an illusory wall and Smouldering Writhing Flesh-filled corridor from Antechamber bonfire. Replaces Estus Shard.
Flask upgrade in Smouldering Lake: In the close end of the Demon Ruins main hall, right below a Smouldering Writhing Flesh. Replaces Undead Bone Shard.
Chest in Smouldering Lake: In a chest past an illusory wall to the left of the Large Hound Rat in Demon Ruins, before the basilisk area. Replaces Large Titanite Shard 3x.
Powerful enemy in Smouldering Lake: Dropped by Knight Slayer Tsorig in Smouldering Lake. Replaces Fume Ultra Greatsword.
Small crystal lizard in Smouldering Lake: Dropped by the Crystal Lizard found from the Antechamber bonfire, toward the Demon Cleric and to the right, then all the way down. Replaces Chaos Gem.
Small crystal lizard in Smouldering Lake: Dropped by the first Crystal Lizard in the cave leading to the pit where Horace can be found in Smouldering Lake. Replaces Twinkling Titanite.
Small crystal lizard in Smouldering Lake: Dropped by the second Crystal Lizard in the cave leading to the pit where Horace can be found in Smouldering Lake. Replaces Titanite Chunk.

--- Irithyll
Key item in Irithyll: On the Giant Blacksmith's corpse in Anor Londo. Replaces Giant's Coal.
Major boss in Irithyll: Dropped by Aldrich. Replaces Soul of Aldrich, Cinders of a Lord (Aldrich).
Major boss in Irithyll: Dropped by Pontiff Sulyvahn. Replaces Soul of Pontiff Sulyvahn.
Flask upgrade in Irithyll: In the graveyard down the stairs from the Church of Yorshka, behind the grave with the Corvian. Replaces Undead Bone Shard.
Chest + Ring in Irithyll: In a chest in Darkmoon Tomb. Replaces Reversal Ring.
Chest + Ring in Irithyll: In a chest up the stairs in the room with the Silver Knight staring at the painting. Replaces Leo Ring.
Chest in Irithyll: In a chest in the rafters of the dark area with the Irithyllian slaves. Replaces Yorshka's Spear.
Chest in Irithyll: In a chest up the stairs in the room with the Silver Knight staring at the painting. Replaces Divine Blessing, Smough's Great Hammer.
Flask upgrade + Chest in Irithyll: In a chest on the floor of the Anor Londo cathedral. Replaces Estus Shard.
Ashes in Irithyll: Dropping down from the rightmost flying buttress, or the rightmost set of stairs. Replaces Easterner's Ashes.
Ashes in Irithyll: In the area with the sewer centipedes, before going up the stairs to the kitchen. Replaces Excrement-covered Ashes.
Powerful enemy in Irithyll: Drop from a mimic in the higher levels of Pontiff's cathedral, accessible from the Deacons after the Pontiff fight. Replaces Golden Ritual Spear.
Powerful enemy in Irithyll: Dropped after killing both of Sulyvahn's Beasts in the Water Reserves. Replaces Ring of Favor.
Small crystal lizard in Irithyll: Dropped a Crystal Lizard straight after the Pontif fight. Replaces Twinkling Titanite.
Small crystal lizard in Irithyll: Dropped by a Crystal Lizard behind an illusory wall before going down the stairs to the lake leading to the Distant Manor bonfire. Replaces Twinkling Titanite.
Small crystal lizard in Irithyll: Dropped by a Crystal Lizard in the higher levels of Pontiff's cathedral, accessible from the Deacons after the Pontiff fight. Replaces Simple Gem.
Small crystal lizard in Irithyll: Dropped by a Crystal Lizard past the Central Irithyll Fire Witches and to the left. Replaces Twinkling Titanite.
Ring in Irithyll: After the Pontiff fight, in the dark hallways to the left of the area with the Giant Slaves. Replaces Dark Stoneplate Ring.
Ring in Irithyll: Dropping down from in front of Pontiff Sulyvahn's church toward the Church of Yorshka. Replaces Ring of the Sun's First Born.
Ring in Irithyll: In the Anor Londo cathedral after defeating Aldrich, up the elevators in Gwynevere's Chamber. Replaces Sun Princess Ring.
Ring in Irithyll: In the area before and below Pontiff's cathedral, behind an illusory wall to the right. Replaces Magic Clutch Ring.
Ring in Irithyll: Near the sewer centipede at the start of the lake leading to the Distant Manor bonfire. Replaces Ring of Sacrifice.

--- Irithyll Dungeon
Key item in Irithyll Dungeon: In a chest found going past the Giant Slave to the sewer with the rats and the basilisks, up the stairs to the end, on the right side. Replaces Old Cell Key.
Key item in Irithyll Dungeon: In the cell of the top corridor opposite to the bonfire in Irithyll Dungeon. Replaces Jailbreaker's Key.
Key item in Irithyll Dungeon: In the room with the Wretches next to the main Jailer cell block, guarded by a Wretch. Replaces Profaned Coal.
Flask upgrade + Powerful enemy in Irithyll Dungeon: Dropped by the mimic in the room after the outside area of Irithyll Dungeon overlooking Profaned Capital. Replaces Estus Shard.
Ashes in Irithyll Dungeon: In the cell in the main Jailer cell block to the left of the Profaned Capital exit. Replaces Xanthous Ashes.
Powerful enemy in Irithyll Dungeon: Dropped by the mimic found going past the Giant Slave to the sewer with the rats and the basilisks, up the first flight of stairs, on the left side. Replaces Dark Clutch Ring.
Powerful enemy in Irithyll Dungeon: Dropped by the mimic in the main Jailer cell block. Replaces Titanite Scale 2x.
Powerful enemy in Irithyll Dungeon: Dropped by the mimic in the side corridor from where the Giant Slave is standing, before the long ladder. Replaces Dragonslayer Lightning Arrow 10x.
Small crystal lizard in Irithyll Dungeon: Dropped by the Crystal Lizard on the bottom corridor opposite from the bonfire in Irithyll Dungeon where a Wretch attacks you. Replaces Titanite Scale.
Small crystal lizard in Irithyll Dungeon: Dropped by the Crystal Lizard where the Giant Slave is resting his head. Replaces Titanite Chunk.
Ring in Irithyll Dungeon: In the cell in the main Jailer cell block to the left of the Profaned Capital exit. Replaces Dusk Crown Ring.

--- Profaned Capital
Key item in Profaned Capital: Past the Profaned Capital Court Sorcerer, in the corridor overlooking the Irithyll Dungeon Giant Slave area. Replaces Jailer's Key Ring.
Major boss in Profaned Capital: Dropped by Yhorm the Giant. Replaces Soul of Yhorm the Giant, Cinders of a Lord (Yhorm).
Flask upgrade in Profaned Capital: On the corpse of Laddersmith Gilligan next to the Profaned Capital bonfire. Replaces Undead Bone Shard.
Chest in Profaned Capital: To the right of the Profaned Flame, in the room with the many Jailers looking at the mimics. Replaces Ember.
Powerful enemy in Profaned Capital: Dropped by the court sorcerer above the toxic pool. Replaces Logan's Scroll.
Powerful enemy in Profaned Capital: Dropped by the left mimic surrounded by the Jailers to the right of the Profaned Flame. Replaces Greatshield of Glory.
Powerful enemy in Profaned Capital: Dropped by the mimic on the second floor of the Monstrosity of Sin building. Replaces Court Sorcerer's Staff.
Powerful enemy in Profaned Capital: Dropped by the right mimic surrounded by the Jailers to the right of the Profaned Flame. Replaces Rusted Gold Coin 2x.
Small crystal lizard in Profaned Capital: Dropped by the first Crystal Lizard in the corridors before the Profaned Capital toxic pool. Replaces Twinkling Titanite.
Small crystal lizard in Profaned Capital: Dropped by the second Crystal Lizard in the corridors before the Profaned Capital toxic pool. Replaces Twinkling Titanite.
Ring in Profaned Capital: In the inner cave of the Profaned Capital toxic pool. Replaces Cursebite Ring.

--- Irithyll Dungeon with Jailbreaker's Key
Ring in Irithyll Dungeon with Jailbreaker's Key: Dropping down from the Jailbreaker's Key shortcut at the end of the top corridor on the bonfire side in Irithyll Dungeon. Replaces Bellowing Dragoncrest Ring.

--- Irithyll Dungeon Jailer's Cells
Ashes in Irithyll Dungeon Jailer's Cells: In the cell at the far end of the bottom corridor on the bonfire side in Irithyll Dungeon. Replaces Prisoner Chief's Ashes.

--- Irithyll Dungeon Old Cell
Ring in Irithyll Dungeon Old Cell: In the Old Cell where Siegward is rescued. Replaces Covetous Gold Serpent Ring.

--- Lothric Castle
Major boss in Lothric Castle: Dropped by Dancer of the Boreal Valley. Replaces Soul of the Dancer.
Major boss in Lothric Castle: Dropped by Dragonslayer Armour. Replaces Soul of Dragonslayer Armour.
Flask upgrade in Lothric Castle: Dropping down from the bridge where the Pus of Man wyverns breathe fire on the far side from the bonfire. Replaces Undead Bone Shard.
Chest in Lothric Castle: In a chest climbing the ladder to the rooftop outside the Dragonslayer Armour fight, continuing the loop past the Red-Eyed Lothric Knight. Replaces Titanite Scale 3x.
Chest in Lothric Castle: In a chest in the basement with the Outrider Knight. Replaces Spirit Tree Crest Shield, Titanite Scale, Twinkling Titanite, Twinkling Titanite 2x.
Chest in Lothric Castle: In a chest in the chapel to the right of the Dragonslayer Armour fight. Replaces Titanite Scale.
Chest in Lothric Castle: In a chest right after the Lothric Castle bonfire. Replaces Hood of Prayer.
Powerful enemy in Lothric Castle: Dropped by the Boreal Outrider Knight in the basement. Replaces Irithyll Rapier.
Powerful enemy in Lothric Castle: Dropped by the crawling mimic at the top of the room with the firebomb-throwing hollows. Replaces Titanite Scale 3x.
Powerful enemy in Lothric Castle: Dropped by the first Pus of Man wyvern. Replaces Titanite Chunk 2x, Ember 2x.
Powerful enemy in Lothric Castle: Dropped by the mimic in the room next to the second Pus of Man wyvern. Replaces Sunlight Straight Sword.
Powerful enemy in Lothric Castle: Dropped by the second Pus of Man wyvern. Replaces Titanite Chunk 2x, Ember 2x.
Small crystal lizard in Lothric Castle: Dropped by the Crystal Lizard after the room with the firebomb-throwing hollows around the front. Replaces Twinkling Titanite 2x.
Small crystal lizard in Lothric Castle: Dropped by the Crystal Lizard near the thieves after dropping down to the area with the Pus of Man transforming hollows. Replaces Twinkling Titanite 2x.
Ring in Lothric Castle: Climbing the ladder to the rooftop outside the Dragonslayer Armour fight, past the Large Hollow Soldier, down into the room with the tables. Replaces Knight's Ring.
Ring in Lothric Castle: From the chapel to the right of the Dragonslayer Armour fight, on the balcony to the left. Replaces Red Tearstone Ring.

--- Consumed King's Gardens
Major boss in Consumed King's Gardens: Dropped by Consumed King Oceiros. Replaces Soul of Consumed Oceiros.
Flask upgrade in Consumed King's Gardens: From the middle level of the first Consumed King's Gardens elevator, out the balcony and to the right. Replaces Estus Shard.
Chest in Consumed King's Gardens: Chest after Oceiros fight. Replaces Titanite Scale.
Ring in Consumed King's Gardens: Along the right wall of the garden, next to the first elevator building. Replaces Ring of Sacrifice.
Ring in Consumed King's Gardens: From the middle level of the second elevator, toward the Oceiros boss fight. Replaces Dragonscale Ring.

--- Untended Graves
Key item in Untended Graves: Behind an illusory wall, in the same location Irina sits in Firelink Shrine. Replaces Eyes of a Fire Keeper.
Major boss in Untended Graves: Dropped by Champion Gundyr. Replaces Soul of Champion Gundyr.
Shop in Untended Graves: Sold or dropped by Untended Graves Handmaid. Killing her is not recommended
Ring in Untended Graves: In the coffin similar to your initial spawn location, guarded by Corvians. Replaces Ashen Estus Ring.
Ring in Untended Graves: On a cliffside to the right of the main path leading up to dark Firelink Shrine, after Abyss Watchers is defeated. Replaces Hornet Ring.

--- Lothric Castle after Yhorm and Aldrich
Key item in Lothric Castle after Yhorm and Aldrich: Before the door to the Grand Archives after Aldrich and Yhorm are killed. Replaces Gotthard Twinswords, Grand Archives Key.

--- Grand Archives
Major boss in Grand Archives: Dropped by Twin Princes. Replaces Soul of the Twin Princes, Cinders of a Lord (Lothric).
Flask upgrade in Grand Archives: On the Archives roof near the three Winged Knights, in a side area overlooking the ocean. Replaces Estus Shard.
Flask upgrade in Grand Archives: On the corpse of a sitting Archives Scholar on a balcony high in the Archives overlooking the area with the Grand Archives Scholars with a shortcut ladder, near the final wax pool. Replaces Undead Bone Shard.
Chest in Grand Archives: Behind a bookshelf in the dark room with the Crystal Lizards, moved by a lever in the same room. Replaces Witch's Locks.
Chest in Grand Archives: In a chest after the first elevator shortcut with the movable bookshelf, in the area with the Grand Archives Scholars, to the left of the stairwell leading up to the roof. Replaces Titanite Scale 3x.
Chest in Grand Archives: In a chest on the Archives first floor, behind a bookshelf moved by pulling a lever in the middle of the second floor between two cursed bookshelves. Replaces Titanite Slab.
Chest in Grand Archives: In a chest reachable after dropping down from the Archives rafters and down a ladder near the Corpse-grub. Replaces Divine Blessing, Twinkling Titanite 3x.
Powerful enemy in Grand Archives: Dropped by an Outrider Knight past the Crystal Sage's third floor location and an illusory wall. Replaces Outrider Knight Helm.
Powerful enemy in Grand Archives: Dropped by Black Hand Kamui before the stairs leading up to Twin Princes. Replaces Onikiri and Ubadachi.
Powerful enemy in Grand Archives: Dropped by Daughter of Crystal Kriemhild before the stairs leading up to Twin Princes. Replaces Sage's Crystal Staff.
Powerful enemy in Grand Archives: Dropped by Lion Knight Albert before the stairs leading up to Twin Princes. Replaces Golden Wing Crest Shield.
Powerful enemy in Grand Archives: Dropped by the Grand Archives Crystal Sage. Replaces Crystal Scroll.
Small crystal lizard in Grand Archives: Dropped by a Crystal Lizard found heading from the first elevator shortcut with the movable bookshelf, on the right side up the stairs before exiting to the roof. Replaces Twinkling Titanite.
Small crystal lizard in Grand Archives: Dropped by a Crystal Lizard on first floor bookshelves. Can be acessed by dropping down to the left at the end of the bridge which is the Crystal Sage's final location. Replaces Titanite Scale 2x.
Small crystal lizard in Grand Archives: Dropped by a Crystal Lizard on the Archives first floor in the dark room past the large wax pool. Replaces Twinkling Titanite, Twinkling Titanite 2x.
Small crystal lizard in Grand Archives: Dropped by one of the pair of Crystal Lizards, on the left side, found going up a slope past the gargoyle on the Archives roof. Replaces Twinkling Titanite.
Small crystal lizard in Grand Archives: Dropped by one of the pair of Crystal Lizards, on the right side, found going up a slope past the gargoyle on the Archives roof. Replaces Twinkling Titanite.
Small crystal lizard in Grand Archives: Dropped by the Crystal Lizard on the Archives first floor along the left wall. Replaces Crystal Gem, Twinkling Titanite.
Small crystal lizard in Grand Archives: Dropped by the Crystal Lizard on the Archives second floor, going toward the stairs/balcony. Replaces Twinkling Titanite 2x.
Ring in Grand Archives: At the top of the ladder in roof the area with the Winged Knights. Replaces Hunter's Ring.
Ring in Grand Archives: From the first shortcut elevator with the movable bookshelf, past the Scholars right before going outside onto the roof, in an alcove to the right with many Clawed Curse bookshelves. Replaces Fleshbite Ring.
Ring in Grand Archives: On the corpse of a sitting Archives Scholar between two bookshelves, accessible by activating a lever before crossing the bridge that is the Crystal Sage's final location. Replaces Scholar Ring.

--- Archdragon Peak
Major boss in Archdragon Peak: Dropped by Ancient Wyvern. Replaces Dragon Head Stone.
Major boss in Archdragon Peak: Dropped by Nameless King. Replaces Soul of the Nameless King.
Chest in Archdragon Peak: In a chest after the sagging wooden bridge on the way to the Belfry, in the building with the Crystal Lizard. Replaces Titanite Scale 3x.
Chest in Archdragon Peak: In the chest before the ladder climbing up to the Havel Knight. Replaces Twinkling Titanite 3x.
Ashes in Archdragon Peak: In the run-up to the Dragon Altar after the Belfry bonfire, in a side path to the left side. Replaces Dragon Chaser's Ashes.
Powerful enemy in Archdragon Peak: Dropped from any of the Havel Knights. Replaces Dragon Tooth.
Small crystal lizard in Archdragon Peak: Dropped by Crystal Lizard in the building after the sagging wooden bridge toward the Belfry. Replaces Twinkling Titanite 3x.
Ring in Archdragon Peak: After the long hallway after the Mausoleum bonfire, before the rope bridge, up the long ladder. Replaces Thunder Stoneplate Ring.
Ring in Archdragon Peak: Received using Path of the Dragon at the Altar by the Mausoleum bonfire. Replaces Calamity Ring.
Ring in Archdragon Peak: To the left of gate leading to Ancient Wyvern, past the Rock Lizard. Replaces Lightning Clutch Ring.
Ring in Archdragon Peak: To the right of the area where the Ancient Wyvern lands, dropping down onto the ledge. Replaces Ring of Steel Protection.

--- Pre-Contraption Ariandel
Key item in pre-Contraption Ariandel: Dropped by Sir Vilhelm. Replaces Contraption Key.
Major boss in pre-Contraption Ariandel: Dropped by Champion's Gravetender. Replaces Valorheart.
Ashes in pre-Contraption Ariandel: At the very top of the Millwood Knight tower after climbing up the second ladder. Replaces Captain's Ashes.
Powerful enemy in pre-Contraption Ariandel: Dropped by Sir Vilhelm. Replaces Onyx Blade.
Small crystal lizard in pre-Contraption Ariandel: Crossing the bridge after Corvian Settlement bonfire, follow the left edge past another bridge until a dropdown point looping back to the bonfire. Hug the bonfire building's outer wall along the right side. Replaces Large Titanite Shard 2x.
Small crystal lizard in pre-Contraption Ariandel: Dropped by a Crystal Lizard after the Rope Bridge Cave on the way to Corvian Settlement. Replaces Large Titanite Shard.
Small crystal lizard in pre-Contraption Ariandel: Dropped by a Crystal Lizard in the Millwood Knight tower, climbing up the first ladder and descending the stairs down. Replaces Twinkling Titanite.
Small crystal lizard in pre-Contraption Ariandel: Dropped by a Crystal Lizard in the tree branch area after climbing down the rope bridge, before the ledge with the Follower Javelin wielder. Replaces Twinkling Titanite.
Small crystal lizard in pre-Contraption Ariandel: Dropped by a Crystal Lizard on a bridge in Corvian Settlement before the rooftop of the chapel with the Corvian Knight inside. Replaces Twinkling Titanite.
Ring in pre-Contraption Ariandel: Given by Sister Friede while she is sitting in the Ariandel Chapel, or on the stool after she moves. Replaces Chillbite Ring.

--- Post-Contraption Ariandel
Major boss in post-Contraption Ariandel: Dropped by Sister Friede. Replaces Soul of Sister Friede.
Major boss in post-Contraption Ariandel: One-time drop after killing Father Ariandel and Friede (phase 2) for the first time. Replaces Titanite Slab.
Small crystal lizard in post-Contraption Ariandel: Dropped by a Crystal Lizard past an illusory wall nearly straight left of the mechanism that moves the statue in the lowest level of the Ariandel Chapel basement. Replaces Twinkling Titanite.

--- Dreg Heap
Key item in Dreg Heap: Found in the small room after beating Demon Prince. Replaces Small Envoy Banner.
Major boss in Dreg Heap: Dropped by Demon Prince. Replaces Soul of the Demon Prince.
Shop in Dreg Heap: Sold by Stone-humped Hag, or in her ashes
Powerful enemy in Dreg Heap: Dropped by Desert Pyromancer Zoey. Replaces Flame Fan.
Ring in Dreg Heap: After exiting the building with the Lothric Knights where the front crumbles, to the last room of the building to the right, up stairs past an illusory wall to the left, then dropping down after exiting the building from the last room. Replaces Covetous Silver Serpent Ring+3.
Ring in Dreg Heap: After the dropdown where an angel first targets you, on an exposed edge to the left. Difficult to get without killing the angel. Replaces Ring of Steel Protection+3.
Ring in Dreg Heap: Up the long branch close to the dropdown into the poison swamp area, in front of the cavern. Replaces Ring of Favor+3.

--- Ringed City
Major boss in Ringed City: Dropped by Darkeater Midir. Replaces Soul of Darkeater Midir, Spears of the Church.
Major boss in Ringed City: Dropped by Halflight, Spear of the Church. Replaces Titanite Slab, Filianore's Spear Ornament.
Powerful enemy in Ringed City: Dropped by mimic in Shared Grave. In one of the rooms after dropping down near Gael's flag and then dropping down again. Replaces Ring of the Evil Eye+3.
Powerful enemy in Ringed City: Given by Shira after defeating Midir, or dropped by her in post-Filianore Ringed City. Replaces Titanite Slab.
Small crystal lizard in Ringed City: Dropped by the Crystal Lizard on the stairs going up from Shared Grave to Ringed Inner Wall elevator. Replaces Titanite Scale 2x.
Small crystal lizard in Ringed City: Dropped by the Crystal Lizard right after the crumbling stairs in Shared Grave. Replaces Twinkling Titanite, Titanite Scale.
Small crystal lizard in Ringed City: Dropped by the Crystal Lizard which runs across the bridge after climbing the very long ladder up from the muck pit. Replaces Twinkling Titanite 2x.
Small crystal lizard in Ringed City: Dropped by the first Crystal Lizard on the side path on the right side of the Mausoleum Lookout courtyard. Replaces Twinkling Titanite, Titanite Scale.
Ring in Ringed City: Dropping down from the building where Silver Knight Ledo invades. The building is up the very long ladder from the muck pit, down the path all the way to the right. Replaces Havel's Ring+3.
Ring in Ringed City: From the mid level of the Ringed Inner Wall elevator that leads to the Midir fight, dropping back down toward the way to Filianore, onto a platform with a Gwyn statue. Try to land on the platform rather than the statue. Replaces Chloranthy Ring+3.
Ring in Ringed City: Going up the very long ladder from the muck pit, then up some stairs, to the left, and across the bridge, in a building past the Ringed Knights. Also where Lapp can be found to tell him of the Purging Monument. Replaces Covetous Gold Serpent Ring+3.

--- Filianore's Rest
Major boss in Filianore's Rest: Dropped by Slave Knight Gael. Replaces Soul of Slave Knight Gael.
Powerful enemy in Filianore's Rest: Dropped by Shira, who invades you (ember not required) in the far-future version of her room. Replaces Crucifix of the Mad King.

--- Kiln of the First Flame
Major boss in Kiln of the First Flame: Dropped by Soul of Cinder. Replaces Soul of the Lords.`;

// ---------------------------------------------------------------------------
// Parse raw text into DATA structure
// ---------------------------------------------------------------------------
function parseData(text) {
  const ariandelNames = new Set(['Pre-Contraption Ariandel', 'Post-Contraption Ariandel']);
  const ringedCityNames = new Set(['Dreg Heap', 'Ringed City', "Filianore's Rest"]);

  const baseGame = [];
  const ariandel = [];
  const ringedCity = [];

  let currentLocation = null;

  for (const line of text.split('\n')) {
    const trimmed = line.trim();
    if (!trimmed) continue;

    if (trimmed.startsWith('--- ')) {
      const name = trimmed.slice(4);
      currentLocation = { name, items: [] };

      if (ariandelNames.has(name)) ariandel.push(currentLocation);
      else if (ringedCityNames.has(name)) ringedCity.push(currentLocation);
      else baseGame.push(currentLocation);
      continue;
    }

    if (!currentLocation) continue;

    const colonIdx = trimmed.indexOf(': ');
    if (colonIdx === -1) continue;

    const afterColon = trimmed.slice(colonIdx + 2);
    const replacesIdx = afterColon.indexOf('. Replaces ');

    if (replacesIdx !== -1) {
      const desc = afterColon.slice(0, replacesIdx);
      let replaces = afterColon.slice(replacesIdx + 11);
      if (replaces.endsWith('.')) replaces = replaces.slice(0, -1);
      currentLocation.items.push({ desc, replaces });
    } else {
      currentLocation.items.push({ desc: afterColon, replaces: null });
    }
  }

  const sections = [{ section: null, locations: baseGame }];
  if (ariandel.length) sections.push({ section: 'Ashes of Ariandel', locations: ariandel });
  if (ringedCity.length) sections.push({ section: 'The Ringed City', locations: ringedCity });
  return sections;
}

const DATA = parseData(RAW_DATA);

// ---------------------------------------------------------------------------
// Room & state management
// ---------------------------------------------------------------------------
const ROOM_KEY = 'ds3-tracker-room';

function itemId(locName, idx) {
  // Firebase keys cannot contain . $ # [ ] / - encode periods
  return `${locName.replace(/\./g, '%2E')}::${idx}`;
}

let checkedState = {};
let currentFilter = 'all';
let currentRoom = null;
let itemsRef = null;
let firebaseListener = null;
let waitingForInitialData = false;

function generateRoomCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = '';
  for (let i = 0; i < 6; i++) code += chars[Math.floor(Math.random() * chars.length)];
  return code;
}

// ---------------------------------------------------------------------------
// Firebase sync (uses ds3rooms/ path to keep separate from Elden Ring)
// ---------------------------------------------------------------------------
function joinRoom(code) {
  if (firebaseListener && itemsRef) {
    itemsRef.off('value', firebaseListener);
  }

  currentRoom = code.toUpperCase();
  localStorage.setItem(ROOM_KEY, currentRoom);
  itemsRef = db.ref('ds3rooms/' + currentRoom + '/items');

  firebaseListener = itemsRef.on('value', (snapshot) => {
    document.getElementById('syncError').hidden = true;
    checkedState = snapshot.val() || {};
    if (waitingForInitialData) {
      waitingForInitialData = false;
      render();
    } else {
      refreshUI();
    }
  }, (error) => {
    showSyncError('Firebase sync failed: ' + error.message + ' \u2014 check your database rules.');
    if (waitingForInitialData) {
      waitingForInitialData = false;
      render();
    }
  });

  document.getElementById('roomOverlay').hidden = true;
  document.getElementById('roomBadge').hidden = false;
  document.getElementById('roomCodeDisplay').textContent = currentRoom;
}

function leaveRoom() {
  if (firebaseListener && itemsRef) {
    itemsRef.off('value', firebaseListener);
  }
  firebaseListener = null;
  itemsRef = null;
  currentRoom = null;
  checkedState = {};
  localStorage.removeItem(ROOM_KEY);

  document.getElementById('roomBadge').hidden = true;
  document.getElementById('roomOverlay').hidden = false;
  document.getElementById('roomError').textContent = '';
  document.getElementById('roomCodeInput').value = '';

  refreshUI();
}

function showSyncError(msg) {
  const el = document.getElementById('syncError');
  el.textContent = msg;
  el.hidden = false;
}

function setItemChecked(id, checked) {
  if (checked) checkedState[id] = true;
  else delete checkedState[id];
  refreshUI();

  if (!itemsRef) return;
  const op = checked ? itemsRef.child(id).set(true) : itemsRef.child(id).remove();
  op.catch(() => showSyncError('Failed to sync \u2014 check Firebase database rules (must allow read/write).'));
}

function resetAllProgress() {
  if (!itemsRef) return;
  checkedState = {};
  refreshUI();
  itemsRef.remove()
    .catch(() => showSyncError('Failed to reset \u2014 check Firebase database rules.'));
}

// ---------------------------------------------------------------------------
// Progress
// ---------------------------------------------------------------------------
function getTotalAndChecked() {
  let total = 0, done = 0;
  DATA.forEach(s => s.locations.forEach(loc => {
    loc.items.forEach((_, i) => {
      total++;
      if (checkedState[itemId(loc.name, i)]) done++;
    });
  }));
  return { total, done };
}

function updateProgress() {
  const { total, done } = getTotalAndChecked();
  document.getElementById('progressCount').textContent = `${done} / ${total}`;
  const pct = total ? Math.round((done / total) * 100) : 0;
  document.getElementById('progressPercent').textContent = `${pct}%`;
  document.getElementById('progressFill').style.width = `${pct}%`;
}

// ---------------------------------------------------------------------------
// Rendering
// ---------------------------------------------------------------------------
function render() {
  const main = document.getElementById('main');
  main.innerHTML = '';

  DATA.forEach(section => {
    if (section.section) {
      const divider = document.createElement('div');
      divider.className = 'dlc-divider';
      divider.innerHTML = `<h2>${section.section}</h2>`;
      main.appendChild(divider);
    }

    section.locations.forEach(loc => {
      const locDiv = document.createElement('div');
      locDiv.className = 'location';
      locDiv.dataset.name = loc.name.toLowerCase();

      const locDone = loc.items.filter((_, i) => checkedState[itemId(loc.name, i)]).length;
      if (locDone === loc.items.length) locDiv.classList.add('all-done');

      const header = document.createElement('div');
      header.className = 'location-header';
      header.innerHTML = `
        <h3>${loc.name}</h3>
        <span class="location-count"><span class="done">${locDone}</span> / ${loc.items.length}</span>
      `;
      locDiv.appendChild(header);

      const itemsDiv = document.createElement('div');
      itemsDiv.className = 'items';
      locDiv.appendChild(itemsDiv);

      header.addEventListener('click', () => {
        const collapsed = itemsDiv.dataset.collapsed === 'true';
        itemsDiv.dataset.collapsed = collapsed ? 'false' : 'true';
      });

      loc.items.forEach((item, i) => {
        const id = itemId(loc.name, i);
        const isChecked = !!checkedState[id];

        const itemDiv = document.createElement('div');
        itemDiv.className = 'item' + (isChecked ? ' checked' : '');
        itemDiv.dataset.id = id;

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = isChecked;

        const textSpan = document.createElement('span');
        textSpan.className = 'item-text';
        if (item.replaces) {
          textSpan.innerHTML = `${item.desc}. <span class="item-replaces">\u2192 ${item.replaces}</span>`;
        } else {
          textSpan.textContent = item.desc;
        }

        itemDiv.appendChild(cb);
        itemDiv.appendChild(textSpan);
        itemsDiv.appendChild(itemDiv);

        itemDiv.addEventListener('click', (e) => {
          if (e.target === cb) return;
          cb.checked = !cb.checked;
          cb.dispatchEvent(new Event('change'));
        });

        cb.addEventListener('change', () => {
          setItemChecked(id, cb.checked);
        });
      });

      main.appendChild(locDiv);
    });
  });

  // Reset button
  const resetArea = document.createElement('div');
  resetArea.className = 'reset-area';
  resetArea.innerHTML = `<button class="reset-btn" id="resetBtn">Reset All Progress</button>`;
  main.appendChild(resetArea);

  document.getElementById('resetBtn').addEventListener('click', () => {
    if (confirm('Reset all progress? This will clear progress for everyone in this room and cannot be undone.')) {
      resetAllProgress();
    }
  });

  applyFilters();
  updateProgress();
}

function refreshUI() {
  document.querySelectorAll('.location').forEach(locEl => {
    let locDone = 0;
    let locTotal = 0;

    locEl.querySelectorAll('.item').forEach(itemEl => {
      const id = itemEl.dataset.id;
      const isChecked = !!checkedState[id];
      locTotal++;
      if (isChecked) locDone++;

      const cb = itemEl.querySelector('input[type="checkbox"]');
      if (cb.checked !== isChecked) cb.checked = isChecked;
      if (isChecked) itemEl.classList.add('checked');
      else itemEl.classList.remove('checked');
    });

    const countEl = locEl.querySelector('.done');
    if (countEl) countEl.textContent = locDone;

    if (locDone === locTotal) locEl.classList.add('all-done');
    else locEl.classList.remove('all-done');
  });

  updateProgress();
  applyFilters();
}

// ---------------------------------------------------------------------------
// Filters
// ---------------------------------------------------------------------------
function applyFilters() {
  const query = document.getElementById('searchBox').value.toLowerCase().trim();

  document.querySelectorAll('.location').forEach(locEl => {
    const locName = locEl.dataset.name;
    let anyVisible = false;

    locEl.querySelectorAll('.item').forEach(itemEl => {
      const id = itemEl.dataset.id;
      const isChecked = !!checkedState[id];
      const text = itemEl.textContent.toLowerCase();
      const matchesSearch = !query || text.includes(query) || locName.includes(query);
      const matchesFilter = currentFilter === 'all' ||
        (currentFilter === 'checked' && isChecked) ||
        (currentFilter === 'unchecked' && !isChecked);

      const visible = matchesSearch && matchesFilter;
      itemEl.dataset.hidden = visible ? 'false' : 'true';
      if (visible) anyVisible = true;
    });

    locEl.dataset.hidden = anyVisible ? 'false' : 'true';
  });
}

// Info box toggle
document.getElementById('infoToggle').addEventListener('click', () => {
  document.getElementById('infoToggle').classList.toggle('open');
  document.getElementById('infoContent').classList.toggle('open');
});

// Filter buttons
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentFilter = btn.dataset.filter;
    applyFilters();
  });
});

// Search
document.getElementById('searchBox').addEventListener('input', applyFilters);

// ---------------------------------------------------------------------------
// Room UI event handlers
// ---------------------------------------------------------------------------
document.getElementById('createRoomBtn').addEventListener('click', () => {
  const code = generateRoomCode();
  document.getElementById('roomError').textContent = '';
  joinRoom(code);
  render();
});

document.getElementById('joinRoomBtn').addEventListener('click', () => {
  const input = document.getElementById('roomCodeInput').value.trim().toUpperCase();
  const errorEl = document.getElementById('roomError');
  if (!input || input.length < 3) {
    errorEl.textContent = 'Please enter a valid room code.';
    return;
  }
  errorEl.textContent = '';
  joinRoom(input);
  render();
});

document.getElementById('roomCodeInput').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') document.getElementById('joinRoomBtn').click();
});

document.getElementById('leaveRoomBtn').addEventListener('click', () => {
  leaveRoom();
  render();
});

// ---------------------------------------------------------------------------
// Init
// ---------------------------------------------------------------------------
const savedRoom = localStorage.getItem(ROOM_KEY);
if (savedRoom) {
  waitingForInitialData = true;
  joinRoom(savedRoom);
} else {
  render();
  document.getElementById('roomOverlay').hidden = false;
}
</script>
</body>
</html>
